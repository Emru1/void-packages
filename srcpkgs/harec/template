# Template file for 'harec'
pkgname=harec
version=0.24.2
revision=1
archs="x86_64 x86_64-musl aarch64 aarch64-musl riscv64 riscv64-musl"
build_style=configure
checkdepends="qbe"
short_desc="Bootstrap compiler for Hare"
maintainer="Emil Tomczyk <emru@emru.xyz>"
license="GPL-3.0-only"
homepage="https://git.sr.ht/~sircmpwn/harec"
changelog="https://git.sr.ht/~sircmpwn/harec/refs"
distfiles="https://git.sr.ht/~sircmpwn/harec/archive/${version}.tar.gz"
checksum=88b3961b236fbfe3a0dfb46bb954741fa5c031bbda6d07fbc238c98f0abb41a2

do_configure() {
	ARCH="${XBPS_TARGET_MACHINE%-musl}"

	cp configs/linux.mk config.mk
	vsed -i config.mk -e "s|^PREFIX =.*$|PREFIX =/usr|"
	vsed -i config.mk -e "s|^ARCH =.*$|ARCH =${ARCH}|"

	vsed -i config.mk -e "/^CC/d"
	vsed -i config.mk -e "/^AS/d"
	vsed -i config.mk -e "/^LD/d"
}
